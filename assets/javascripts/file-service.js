!function(){var e=angular.module("SwfHelpers",[]);e.factory("FileReader",["$q",function(e){var t=function(e,t,n){return function(){n.$apply(function(){t.resolve(e.result)})}},n=function(e,t,n){return function(){n.$apply(function(){t.reject(e.result)})}},r=function(){return function(){}},a=function(e,a){var i=new FileReader;return i.onload=t(i,e,a),i.onerror=n(i,e,a),i.onprogress=r(i,a),i},i=function(t,n,r){var i=e.defer(),s=a(i,n);return s[r](t),i.promise},s=function(e,t){return i(e,t,"readAsDataURL")},u=function(e,t){return i(e,t,"readAsText")};return{readAsDataURL:s,readAsText:u}}]),e.factory("HistoryTransformer",[function(){var e=function(t){for(var n in t){var r=t[n];angular.isArray(r)&&2==r.length&&"string"==typeof r[0]?t[n]=e(r[1]):"object"==typeof r&&e(r)}return t},t=function(t){var n=angular.fromJson(t);return e(n[1])};return{fromJson:t}}]),e.factory("EventTransformer",[function(){var e={ActivityTaskScheduled:"activity",DecisionTaskScheduled:"decision",TimerStarted:"timer",WorkflowExecutionSignaled:"signal"},t=function(t){var n={};if(angular.isArray(t))for(var r in t){r=t[r];var a=r.eventType[0].toLowerCase()+r.eventType.slice(1)+"EventAttributes",i=r[a]||{},s=null,u=new Date(r.eventTimestamp);/(scheduled|timerStarted)$/i.test(r.eventType)?n[r.eventId]={startDate:u,label:r.eventType,type:e[r.eventType],scheduled:r}:/started$/i.test(r.eventType)?(s=n[i.scheduledEventId],s&&(s.endDate=u,s.started=r)):/(completed|timedout)$/i.test(r.eventType)?(s=n[i.scheduledEventId],s&&(s.endDate=u,s.completed=r)):/timer(fired|canceled)$/i.test(r.eventType)?(s=n[i.startedEventId],s&&(s.endDate=u,s.completed=r)):/workflowExecutionSignaled/i.test(r.eventType)&&(n[r.eventId]={startDate:u,endDate:u,label:r.eventType,type:e[r.eventType],scheduled:r})}var o=[];for(var c in n)o.push(n[c]);o.sort(function(e,t){return e.endDate-t.endDate});var d=o[o.length-1].endDate||new Date;o.sort(function(e,t){return e.startDate-t.startDate});var l=[],v=[];for(var f in o){var p=o[f];p.endDate=p.endDate||d;for(var y=!1,m=0;m<l.length;m++)if(p.startDate>l[m]){y=!0,p.taskName="L"+(m+1),l[m]=p.endDate;break}y||(l.push(p.endDate),p.taskName="L"+l.length,v.push(p.taskName))}return{tasks:o,taskNames:v,taskTypes:v}},n=function(e,t){for(var n in e)t[n]=e[n];return t},r=function(e){var t={},r=(e.scheduled,null);return e.scheduled&&(r=e.scheduled.activityTaskScheduledEventAttributes,t=n(r,t),t.scheduleDate=e.scheduled.eventTimestamp),e.started&&(r=e.started.activityTaskStartedEventAttributes,t=n(r,t),t.startDate=e.started.eventTimestamp),e.completed&&(r=e.completed.activityTaskCompletedEventAttributes,t=n(r,t),t.endDate=e.completed.eventTimestamp),t},a=function(e){var t=[];if(e&&e.tasks.length>0)for(var n=0;n<e.tasks.length;n++){var a=e.tasks[n];"activity"===a.type&&t.push(r(a))}return t};return{fromHistory:t,extractActivities:a}}]),e.filter("dateFormatter",function(){return function(e){return new Date(e).toGMTString()}}),e.directive("eventView",[function(){var e=function(t){for(var n in t){var r=t[n];null===r?delete t[n]:"object"==typeof r&&e(r)}},t=function(e){return"string"!=typeof e&&(e=JSON.stringify(e,void 0,2)),e?(e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),e.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(e){var t="number";return/^"/.test(e)?t=/:$/.test(e)?"key":"string":/true|false/.test(e)?t="boolean":/null/.test(e)&&(t="null"),'<span class="js-'+t+'">'+e+"</span>"})):null},n=function(n,r){n.$watch("obj",function(n){if(n){var a=angular.copy(n);e(a);var i=t(a);r.html(i)}})};return{restric:"E",replace:!1,scope:{obj:"="},link:n}}])}();