!function(){angular.module("Gantt",[]).factory("d3Service",[function(){return window.d3}]).directive("ganttChart",["d3Service",function(t){var a=function(a,e){var r={top:10,right:10,bottom:100,left:40},n={top:430,right:10,bottom:20,left:40},s=500-r.top-r.bottom,i=500-n.top-n.bottom;a.$watch("data",function(t){t&&t.tasks.length>0&&(o(),a.taskTypes=t.taskTypes||[],a.tasks=t.tasks||[],d())}),a.$watch("visible",function(n){var s=t.select(e[0])[0][0].offsetWidth-r.left-r.right;n&&a.width!=s&&(o(),d())});var o=function(){t.select(e[0]).selectAll("*").remove()},c=function(){return void 0===a.tasks||a.tasks.length<1?(a.timeDomainStart=t.time.day.offset(new Date,-3),void(a.timeDomainEnd=t.time.hour.offset(new Date,3))):(a.tasks.sort(function(t,a){return t.endDate-a.endDate}),a.timeDomainEnd=a.tasks[a.tasks.length-1].endDate,a.tasks.sort(function(t,a){return t.startDate-a.startDate}),void(a.timeDomainStart=a.tasks[0].startDate))},l=function(t){return t=t||{},t.startDate+t.taskName+t.endDate},d=function(){var o=t.select(e[0])[0][0].offsetWidth-r.left-r.right;if(!(0>o)){a.x=t.time.scale().range([0,o]).clamp(!0),a.x2=t.time.scale().range([0,o]).clamp(!0),a.y=t.scale.ordinal().rangeRoundBands([0,s],.1),a.y2=t.scale.ordinal().rangeRoundBands([0,i],.1),a.xAxis=t.svg.axis().scale(a.x).orient("bottom"),a.xAxis2=t.svg.axis().scale(a.x2).orient("bottom");var d=function(){a.x.domain(a.brush.empty()?a.x2.domain():a.brush.extent());var t=a.x.domain(),e=a.tasks.filter(function(a){return a.startDate<t[1]||a.endDate>t[0]});f.select(".x.axis").call(a.xAxis);var r=f.selectAll(".gantt-rect").data(e,l).attr("x",function(t){return a.x(t.startDate)}).attr("width",function(t){return a.x(t.endDate)-a.x(t.startDate)});r.enter().append("rect").attr("class",function(t){return"gantt-rect "+t.type}).attr("x",function(t){return a.x(t.startDate)}).attr("y",function(t){return a.y(t.taskName)}).attr("height",function(){return a.y.rangeBand()}).attr("width",function(t){return a.x(t.endDate)-a.x(t.startDate)}),r.exit().remove()};a.brush=t.svg.brush().x(a.x2).on("brush",d);var u=t.select(e[0]).append("svg").attr("width",o+r.left+r.right).attr("height",s+r.top+r.bottom);u.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",o).attr("height",s);var f=u.append("g").attr("class","focus").attr("transform","translate("+r.left+","+r.top+")"),m=u.append("g").attr("class","focus").attr("transform","translate("+n.left+","+n.top+")");c(a.tasks),a.x.domain([a.timeDomainStart,a.timeDomainEnd]),a.y.domain(a.taskTypes),a.x2.domain(a.x.domain()),a.y2.domain(a.y.domain()),f.append("g").attr("class","x axis").attr("transform","translate(0,"+s+")").call(a.xAxis);var x=m.selectAll(".gg").data(a.tasks,l).enter().append("g").attr("class","gg");x.append("rect").attr("class",function(t){return"gantt-rect "+t.type}).attr("y",0).attr("transform",function(t){return"translate("+a.x2(t.startDate)+","+a.y2(t.taskName)+")"}).attr("height",function(){return a.y2.rangeBand()}).attr("width",function(t){return a.x2(t.endDate)-a.x2(t.startDate)}),m.append("g").attr("class","x axis").attr("transform","translate(0,"+i+")").call(a.xAxis2),m.append("g").attr("class","x brush").call(a.brush).selectAll("rect").attr("y",-6).attr("height",i+7),d()}}};return{restric:"E",replace:!1,scope:{data:"=",visible:"="},link:a}}])}();